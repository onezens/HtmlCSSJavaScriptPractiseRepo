
	<div id="mainContent">
	<div class="forFlow">
		
<div id="post_detail">
<!--done-->
<div id="topics">
	<div class="post">
		<h1 class="postTitle">
			<a id="cb_post_title_url" class="postTitle2" href="http://www.cnblogs.com/yunfang/p/6078208.html">Android&#x2014;&#x57FA;&#x4E8E;&#x5FAE;&#x4FE1;&#x5F00;&#x653E;&#x5E73;&#x53F0;v3SDK&#xFF0C;&#x5F00;&#x53D1;&#x5FAE;&#x4FE1;&#x652F;&#x4ED8;&#x586B;&#x5751;&#x3002;</a>
		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body"><p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px">&#x63A5;&#x89E6;&#x5FAE;&#x4FE1;&#x652F;&#x4ED8;&#x4E4B;&#x524D;&#x542C;&#x8BF4;&#x8FC7;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5751;&#xFF0C;&#xFF0C;&#xFF0C;&#x5FC3;&#x91CC;&#x5DF2;&#x7ECF;&#x6709;&#x4E86;&#x51C6;&#x5907;&#x3002;&#x3002;&#x3002;&#x6211;&#x4EE5;&#x4E3A;&#x6211;&#x6CA1;&#x51C6;&#x8DF3;&#x5751;&#x51FA;&#x4E0D;&#x6765;&#x4E86;&#xFF0C;&#x6CA1;&#x6709;&#x60F3;&#x5230;&#x6211;&#x586B;&#x4E0A;&#x4E86;&#xFF0C;&#x8C03;&#x7528;&#x6210;&#x529F;&#x4E4B;&#x540E;&#x6211;&#x611F;&#x89C9;&#x516C;&#x53F8;&#x6240;&#x6709;&#x7684;&#x540C;&#x4E8B;&#x90FD;&#x662F;&#x6F02;&#x4EAE;&#x7684;&#xFF0C;&#x9694;&#x7740;&#x5317;&#x4EAC;&#x7684;&#x5927;&#x96FE;&#x973E;&#x6211;&#x4EFF;&#x4F5B;&#x770B;&#x89C1;&#x4E86;&#x592A;&#x9633;~~~&#x597D;&#x4E86;&#xFF0C;&#x88C5;&#x903C;&#x7ED3;&#x675F;&#x3002;&#x3002;&#x3002;&#x8FDB;&#x5165;&#x6B63;&#x9898;</span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px">&#x5F00;&#x53D1;&#x51C6;&#x5907;&#xFF1A;</span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px">1.&#x5728;&#x5FAE;&#x4FE1;&#x5F00;&#x653E;&#x5E73;&#x53F0;&#x7533;&#x8BF7;&#x8D26;&#x53F7;</span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px">2.&#x6210;&#x529F;&#x540E;&#x521B;&#x5EFA;&#x5E94;&#x7528;&#xFF0C;&#x5C31;&#x662F;&#x586B;&#x4E00;&#x4E9B;&#x770B;&#x4F3C;&#x5F88;&#x5B98;&#x65B9;&#x5F88;&#x6B63;&#x7ECF;&#x7684;&#x8D44;&#x6599;&#x4E86;&#x3002;&#x3002;&#x3002;&#xFF08;&#x8BF4;&#x5BA1;&#x6838;7&#x5929;&#x5DE6;&#x53F3;&#xFF0C;&#x6CA1;&#x6709;&#x610F;&#x5916;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x4F60;&#x7684;app&#x7B2C;&#x4E8C;&#x5929;&#x5C31;&#x5BA1;&#x6838;&#x6210;&#x529F;&#x4E86;&#x662F;&#x4E0D;&#x662F;&#x5F88;&#x5F00;&#x5FC3;&#xFF0C;&#x6709;&#x4E86;appid&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x5C31;&#x53EF;&#x4EE5;&#x8C03;&#x7528;&#x5FAE; &#xA0; &#x4FE1;&#x652F;&#x4ED8;&#x4E86;&#xFF1F;&#xFF1F;&#xFF1F;&#xFF1F;-------&#x60F3;&#x591A;&#x4E86;&#xFF0C;&#x771F;&#x7684;&#xFF09;</span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px">3.&#x5FAE;&#x4FE1;&#x652F;&#x4ED8;&#x662F;&#x9700;&#x8981;&#x989D;&#x5916;&#x7533;&#x8BF7;&#x7684;:&#x9700;&#x8981;&#x8D44;&#x6599;&#x5BA1;&#x6838;&#xFF0C;&#x8D26;&#x6237;&#x9A8C;&#x8BC1;&#xFF0C;&#x534F;&#x8BAE;&#x7B7E;&#x7F72;&#x7B49;&#x6B65;&#x9AA4;&#xFF0C;&#xFF08;&#x6211;&#x8BB0;&#x5F97;&#xFF0C;&#xFF0C;&#x8D44;&#x6599;&#x5BA1;&#x6838;&#x8981;&#x586B;&#x5199;&#x7684;&#x4E1C;&#x897F;&#x597D;&#x591A;&#xFF0C;&#xFF0C;&#xFF0C;&#x597D;&#x591A;&#xFF0C;&#xFF0C;&#xFF0C;&#x8D26;&#x6237;&#x9A8C;&#x8BC1;&#x5C31;&#x662F;&#x4F60;&#x5BA1;&#x6838;&#x6210;&#x529F;&#x540E;&#x5FAE;&#x4FE1;&#x4F1A;&#x53D1;&#x9001;&#x90AE;&#x4EF6;&#x5230;&#x4F60; &#xA0; &#x6CE8;&#x518C;&#x65F6;&#x767B;&#x8BB0;&#x7684;&#x90AE;&#x7BB1;&#x8D26;&#x53F7;&#xFF0C;&#x5176;&#x4E2D;&#x542B;&#x6709;&#x968F;&#x673A;&#x91D1;&#x989D;&#x7528;&#x4E8E;&#x8D26;&#x6237;&#x9A8C;&#x8BC1;&#xFF0C;&#x534F;&#x8BAE;&#x7B7E;&#x7F72;&#xFF0C;&#x7565;&#xFF0C;&#x592A;&#x7B80;&#x5355;&#xFF09;&#x4E00;&#x5B9A;&#x8981;&#x597D;&#x597D;&#x9605;&#x8BFB;&#x4F60;&#x90AE;&#x4EF6;&#x7684;&#x4EFB;&#x4F55;&#x4FE1;&#x606F;&#xFF0C;&#x56E0;&#x4E3A;&#x6709;&#x7684;&#x7EC6;&#x8282;&#x9519;&#x4E86;&#xFF0C;&#xFF0C;&#xFF0C;&#x4F60;&#x53EF;&#x80FD;&#x586B;&#x5751;&#x5F88;&#x4E45;&#x3002;&#x3002;&#x3002;&#x3002;&#x3002;&#x3002;</span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px">&#x6B63;&#x5F0F;&#x5F00;&#x53D1;&#x9636;&#x6BB5;&#xFF1A;</span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px; color: #993300">&#x95EE;&#x9898;1&#xFF1A;</span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px; color: #993300">&#x8C03;&#x7528;&#x5B98;&#x65B9;&#x7684;SDK&#x53D1;&#x73B0;&#x53EA;&#x80FD;&#x6210;&#x529F;&#x7684;&#x8C03;&#x8D77;&#x4E00;&#x6B21;&#x5FAE;&#x4FE1;&#xFF0C;&#x518D;&#x6B21;&#x652F;&#x4ED8;&#x7684;&#x65F6;&#x5019;&#x600E;&#x4E48;&#x4E5F;&#x8C03;&#x7528;&#x4E0D;&#x8D77;&#x6765;&#x4E86;</span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px; color: #993300">&#x89E3;&#x51B3;&#xFF1A;</span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px; color: #993300">&#x4F3C;&#x4E4E;&#x4E0D;&#x662F;&#x4EC0;&#x4E48;&#x6B63;&#x7ECF;&#x65B9;&#x6CD5;&#xFF1A;&#x5728;&#x624B;&#x673A;&#x8BBE;&#x7F6E;&#x4E2D;&#x7BA1;&#x7406;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x6E05;&#x9664;&#x5FAE;&#x4FE1;&#x6570;&#x636E;&#xFF0C;&#x7F13;&#x5B58;&#xFF0C;&#xFF0C;&#x518D;&#x6765;&#x4E00;&#x904D;&#xFF0C;&#x7EDD;&#x5BF9;&#x53EF;&#x4EE5;&#x8C03;&#x8D77;&#x6765;&#xFF08;&#x5F53;&#x7136;&#x8FD8;&#x662F;&#x53EA;&#x662F;&#x4E00;&#x6B21;&#x3002;&#x3002;&#x3002;&#x3002;&#xFF09;</span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px">&#x7EE7;&#x7EED;&#xFF1A;</span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px">&#x6211;&#x8BA4;&#x4E3A;&#x8981;&#x7528;&#x5FAE;&#x4FE1;&#x652F;&#x4ED8;&#x561B;&#xFF0C;&#xFF0C;&#x5C31;&#x53EA;&#x770B;&#x4E86;&#x8C03;&#x7528;&#x652F;&#x4ED8;&#x63A5;&#x53E3;&#x7684;&#x6587;&#x6863;&#xFF1A;</span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px"><img src="http://images2015.cnblogs.com/blog/829069/201611/829069-20161118155528592-509648169.png" alt=""></span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px">&#x540E;&#x6765;&#x53D1;&#x73B0;&#x9700;&#x8981;&#x7684;&#x53C2;&#x6570;prepayid&#x662F;&#x600E;&#x4E48;&#x4E5F;&#x627E;&#x4E0D;&#x5230;&#x554A;&#xFF0C;&#xFF0C;&#x540E;&#x6765;&#x624D;&#x53D1;&#x73B0;&#x8FD9;&#x4E2A;prepayid&#x662F;&#x5148;&#x8C03;&#x7528;&#x201D;&#x7EDF;&#x4E00;&#x4E0B;&#x5355;&#x201C;&#x8FD9;&#x4E2A;&#x63A5;&#x53E3;&#x65F6;&#x5019;&#x6E29;&#x99A8;&#x53CD;&#x8FC7;&#x6765;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x4F46;&#x662F;&#x5B98;&#x65B9;&#x7684;SDK&#x4E2D;&#x5E76;&#x6CA1;&#x6709;&#x7EDF;&#x4E00;&#x4E0B;&#x5355;&#x7684;&#x4EE3;&#x7801;&#xFFFD;&#xFFFD;&#xFFFD;&#x5751;&#x5417;&#xFF1F;&#xFF1F;&#xFF1F;</span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px">&#x6240;&#x4EE5;&#x8981;&#x5148;&#x770B;&#x7EDF;&#x4E00;&#x4E0B;&#x5355;&#x6587;&#x6863;&#x4E86; &#xA0;&#xA0;<a href="http://blog.csdn.net/meijuanyou/article/details/51863720" target="_blank">https://pay.weixin.qq.com/wiki/doc/api/app/app.php?chapter=9_1</a></span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px">1.&#x4F7F;&#x7528;&#x81EA;&#x5DF1;&#x7684;APP&#x8C03;&#x7528;&#x7684;&#x65F6;&#x5019;&#x628A;&#x5B98;&#x7F51;down&#x4E0B;&#x6765;&#x7684;SDK&#x4E2D;WXPayEntryActivity&#x62F7;&#x8D1D;&#x5230;&#x81EA;&#x5DF1;&#x7684;&#x9879;&#x76EE;&#xFF0C;&#x6240;&#x5728;&#x5305;&#x7684;&#x540D;&#x5B57;&#x6700;&#x540E;&#x4E00;&#x5B9A;&#x662F;.wxapi&#xFF08;&#x6211;&#x8FDE;&#x5305;&#x4E00;&#x8D77;&#x62F7;&#x4E86;&#x3002;&#x3002;&#x3002;&#x3002;&#xFF09;</span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px">2.&#x5728;&#x9879;&#x76EE;&#x6E05;&#x5355;&#x6587;&#x4EF6;&#x4E2D;&#x586B;&#x5199;&#xFF1A;</span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px"><img src="http://images2015.cnblogs.com/blog/829069/201611/829069-20161118160456435-1465856269.png" alt=""></span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px">&#xA0;</span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px">&#xA0;3.SDK&#x4E2D;&#x7684;AppRegister&#x62F7;&#x8D1D;&#x4E0B;&#x6765;&#xFF0C;&#xFF0C;&#xFF0C;&#x91CC;&#x9762;&#x6362;&#x6210;&#x4F60;&#x81EA;&#x5DF1;&#x7684;appid,&#x7136;&#x540E;&#x5728;&#x9879;&#x76EE;&#x6E05;&#x5355;&#x4E2D;&#x4E5F;&#x6CE8;&#x518C;&#x4E00;&#x4E0B;&#x3002;</span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px">&#xA0;</span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px">&#xA0;<img src="http://images2015.cnblogs.com/blog/829069/201611/829069-20161118160616498-252052613.png" alt=""></span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px">4.&#x91CD;&#x70B9;&#x6765;&#x4E86;&#xFF0C;&#xFF0C;&#x5C31;&#x662F;&#x4F60;APP&#x8981;&#x8C03;&#x5FAE;&#x4FE1;&#x652F;&#x4ED8;&#x7684;activity&#xFF0C;&#x6211;&#x8FD9;&#x8FD8;&#x53EB;PayActivity</span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px">&#xA0;&#x8981;&#x8C03;&#x8D77;&#x5FAE;&#x4FE1;&#x652F;&#x4ED8;&#x9875;&#x9762;&#xFF0C;&#x8981;&#x5728;&#x8FD9;&#x4E2A;activity&#x4E2D;&#xFF0C;&#x5C06;&#x4F60;&#x7684;app&#x6CE8;&#x518C;&#x5230;&#x5FAE;&#x4FE1;</span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px">&#xA0;<img src="http://images2015.cnblogs.com/blog/829069/201611/829069-20161118160909623-1208451782.png" alt=""></span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px">&#x63A5;&#x4E0B;&#x6765;&#x5148;&#x8C03;&#x7528;&#x7EDF;&#x4E00;&#x4E0B;&#x5355;&#x83B7;&#x53D6;prepayid&#xFF0C;&#x53C2;&#x6570;&#xFF0C;&#x5FAE;&#x4FE1;&#x4EBA;&#x5BB6;&#x8981;xml&#x683C;&#x5F0F;&#x7684;&#xFF01;&#x6211;&#x4EEC;&#x5C31;&#x5F97;&#x53D1;&#x9001;xml&#x683C;&#x5F0F;&#x7684;&#xFF01;</span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px"><img src="http://images2015.cnblogs.com/blog/829069/201611/829069-20161118162417435-1286842456.png" alt=""></span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif">&#xA0;</span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px">&#x597D;&#x4E86;&#x8C03;&#x7528;&#x7684;&#x65F6;&#x5019;&#x628A;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x5F53;&#x53C2;&#x6570;&#x4F20;&#xFF0C;&#xFF0C;&#x7B49;&#x5F85;&#x5FAE;&#x4FE1;&#x8FD4;&#x56DE;success&#x5427;&#xFF01;&#x3002;&#x3002;</span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px">&#xA0;&#x6211;&#x9047;&#x89C1;&#x7684;&#x9519;&#x8BEF;&#xFF1A;&#x7B7E;&#x540D;&#x9519;&#x8BEF;</span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px">&#x6211;&#x7684;&#x539F;&#x56E0;&#x662F;&#x5927;&#x610F;&#x4E86;&#xA0;ConfigUtil.NOTIFY_URL&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x5199;&#x7684;&#x7A7A;&#x5B57;&#x7B26;&#x4E32;</span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px">&#x8FD8;&#x6709;&#x662F;&#x56E0;&#x4E3A;debug&#x7248;&#x8FD0;&#x884C;&#x7684;&#xFF0C;&#x6CA1;&#x6709;&#x6253;&#x5305;&#x8FD0;&#x884C;</span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px">&#x8FD4;&#x56DE;&#x6210;&#x529F;&#x4E4B;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x8C03;&#x7528;&#x652F;&#x4ED8;&#x63A5;&#x53E3;&#x4E86;</span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px"><img src="http://images2015.cnblogs.com/blog/829069/201611/829069-20161118163812154-1971604504.png" alt=""></span></p>
<p>&#xA0;</p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif">&#x4E0D;&#x8981;&#x5FD8;&#x4E86;&#x8FD9;&#x4E00;&#x6B65;&#x53BB;&#x8DF3;&#x8F6C;&#x754C;&#x9762;&#xFF0C;&#xFF0C;&#xFF0C;&#xFF0C;&#xFF0C;</span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif"><img src="http://images2015.cnblogs.com/blog/829069/201611/829069-20161118163845107-1109020122.png" alt=""></span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif">&#x6CA1;&#x6709;&#x8DF3;&#x8F6C;&#x5230;&#x5FAE;&#x4FE1;&#x652F;&#x4ED8;&#x53EF;&#x80FD;&#x662F;&#x4F60;&#x7531;&#x8FD0;&#x884C;&#x7684;debug&#x7248;&#x672C;&#xFF0C;&#xFF0C;&#xFF0C;&#xFF0C;&#x6CA1;&#x6709;&#x6253;&#x5305;&#x3002;&#x3002;&#x3002;&#x3002;&#x3002;</span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px">&#x4E0B;&#x9762;&#x662F;&#x6211;&#x7684;PayActivity&#x5B8C;&#x6574;&#x4EE3;&#x7801;&#xFF1A;</span></p>
<div class="cnblogs_Highlighter">
<pre class="brush:java;gutter:true;"><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px">package com.example.taijiapp.ui;

import java.io.StringReader;
import java.net.InetAddress;
import java.net.NetworkInterface;
import java.net.SocketException;
import java.util.Enumeration;
import java.util.HashMap;
import java.util.LinkedList;
import java.util.List;
import java.util.Map;
import java.util.Random;

import org.apache.http.NameValuePair;
import org.apache.http.message.BasicNameValuePair;
import org.xmlpull.v1.XmlPullParser;

import com.example.taijiapp.R;
import com.example.taijiapp.util.Constants;
import com.example.taijiapp.util.MD5;
import com.example.taijiapp.util.T;
import com.example.taijiapp.util.Util;
import com.example.taijiapp.utils.ConfigUtil;
import com.tencent.mm.sdk.modelpay.PayReq;
import com.tencent.mm.sdk.openapi.IWXAPI;
import com.tencent.mm.sdk.openapi.WXAPIFactory;

import android.app.Activity;
import android.app.ProgressDialog;
import android.content.Context;
import android.net.wifi.WifiInfo;
import android.net.wifi.WifiManager;
import android.os.AsyncTask;
import android.os.Bundle;
import android.util.Log;
import android.util.Xml;
import android.view.View;
import android.widget.Button;

public class PayActivity extends Activity {
	PayReq req;
	private IWXAPI msgApi;
	Map&lt;String, String&gt; resultunifiedorder;
	StringBuffer sb;
	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.pay);
		req = new PayReq();
		sb = new StringBuffer();
		msgApi = WXAPIFactory.createWXAPI(this, Constants.APP_ID);
		/**
		 * &#x5C06;app&#x6CE8;&#x518C;&#x5230;&#x5FAE;&#x4FE1;
		 */
		boolean registerApp = msgApi.registerApp(Constants.APP_ID);
		T.show(this, &quot;&#x6CE8;&#x518C;========&quot;+registerApp+&quot;&quot;);
		Button appayBtn = (Button) findViewById(R.id.appay_btn);
		Button check_pay_btn = (Button) findViewById(R.id.check_pay_btn);
		appayBtn.setOnClickListener(new View.OnClickListener() {

			@Override
			public void onClick(View v) {
				GetPrepayIdTask getPrepayId = new GetPrepayIdTask();
				getPrepayId.execute();
			}
		});
		/**
		 * &#x5C06;&#x8BE5;app&#x6CE8;&#x518C;&#x5230;&#x5FAE;&#x4FE1;
		 */
		check_pay_btn.setOnClickListener(new View.OnClickListener() {

			@Override
			public void onClick(View v) {
				genPayReq();
				sendPayReq();
				
			}
		});
//		// &#x751F;&#x6210;&#x7B7E;&#x540D;&#x53C2;&#x6570;
//		Button appay_pre_btn = (Button) findViewById(R.id.appay_pre_btn);
//		appay_pre_btn.setOnClickListener(new View.OnClickListener() {
//
//			@Override
//			public void onClick(View v) {
//				genPayReq();
//			}
//		});
	}
	/**
	 * &#x751F;&#x6210;&#x7B7E;&#x540D;
	 */

	private String genPackageSign(List&lt;NameValuePair&gt; params) {
		StringBuilder sb = new StringBuilder();

		for (int i = 0; i &lt; params.size(); i++) {
			sb.append(params.get(i).getName());
			sb.append(&apos;=&apos;);
			sb.append(params.get(i).getValue());
			sb.append(&apos;&amp;&apos;);
		}
		sb.append(&quot;key=&quot;);
		sb.append(Constants.KEY);
		Log.e(&quot;&#x62FC;&#x63A5;=====&quot;, sb.toString());
		String packageSign = MD5.getMessageDigest(sb.toString().getBytes()).toUpperCase();
		Log.e(&quot;orion&#x751F;&#x6210;&#x7B7E;&#x540D;===&quot;, packageSign);
		return packageSign;
	}

	/**
	 * &#x7B7E;&#x540D;&#x5DE5;&#x5177; &#x4E0D;&#x542B;&#x5546;&#x6237;&#x5BC6;&#x94A5; &#xFF0D;&#x6682;&#x65F6;&#x4E0D;&#x7528; = * &#x7F16;&#x7801;&#x683C;&#x5F0F; UTF-8 = * @return
	 */
	public static String createSignNoKey(List&lt;NameValuePair&gt; params) {
		StringBuilder sb = new StringBuilder();

		for (int i = 0; i &lt; params.size(); i++) {
			sb.append(params.get(i).getName());
			sb.append(&apos;=&apos;);
			sb.append(params.get(i).getValue());
			sb.append(&apos;&amp;&apos;);
		}
		String signStr = sb.toString();
		String subStr = signStr.substring(0, signStr.length() - 1);
		// &#x6CE8;&#x610F;sign&#x8F6C;&#x4E3A;&#x5927;&#x5199;
		return MD5.getMessageDigest(subStr.getBytes()).toUpperCase();
	}

	private String genAppSign(List&lt;NameValuePair&gt; params) {
		StringBuilder sb = new StringBuilder();

		for (int i = 0; i &lt; params.size(); i++) {
			sb.append(params.get(i).getName());
			sb.append(&apos;=&apos;);
			sb.append(params.get(i).getValue());
			sb.append(&apos;&amp;&apos;);
		}
		sb.append(&quot;key=&quot;);
		sb.append(Constants.KEY);

		this.sb.append(&quot;sign str\n&quot; + sb.toString() + &quot;\n\n&quot;);
		String appSign = MD5.getMessageDigest(sb.toString().getBytes());
		Log.e(&quot;orion&quot;, appSign);
		return appSign;
	}

	private String toXml(List&lt;NameValuePair&gt; params) {
		StringBuilder sb = new StringBuilder();
		sb.append(&quot;&lt;xml&gt;&quot;);
		for (int i = 0; i &lt; params.size(); i++) {
			sb.append(&quot;&lt;&quot; + params.get(i).getName() + &quot;&gt;&quot;);

			sb.append(params.get(i).getValue());
			sb.append(&quot;&lt;/&quot; + params.get(i).getName() + &quot;&gt;&quot;);
		}
		sb.append(&quot;&lt;/xml&gt;&quot;);

		Log.e(&quot;orion&quot;, sb.toString());
		return sb.toString();
	}

	private class GetPrepayIdTask extends AsyncTask&lt;Void, Void, Map&lt;String, String&gt;&gt; {

		private ProgressDialog dialog;

		@Override
		protected void onPreExecute() {
			dialog = ProgressDialog.show(PayActivity.this, getString(R.string.app_tip),
					getString(R.string.getting_prepayid));
		}

		@Override
		protected void onPostExecute(Map&lt;String, String&gt; result) {
			if (dialog != null) {
				dialog.dismiss();
			}
			sb.append(&quot;prepay_id\n&quot; + result.get(&quot;prepay_id&quot;) + &quot;\n\n&quot;);

			resultunifiedorder = result;

		}

		@Override
		protected void onCancelled() {
			super.onCancelled();
		}

		@Override
		protected Map&lt;String, String&gt; doInBackground(Void... params) {

			String url = String.format(&quot;https://api.mch.weixin.qq.com/pay/unifiedorder&quot;);
			String entity = genProductArgs();
			Log.e(&quot;orion===&#x53D1;&#x9001;&#x8FC7;&#x53BB;&quot;, entity);
			byte[] buf = Util.httpPost(url, entity);

			String content = new String(buf);
			Log.e(&quot;orion&quot;, content);
			Map&lt;String, String&gt; xml = decodeXml(content);

			return xml;
		}
	}

	public Map&lt;String, String&gt; decodeXml(String content) {

		try {
			Map&lt;String, String&gt; xml = new HashMap&lt;String, String&gt;();
			XmlPullParser parser = Xml.newPullParser();
			parser.setInput(new StringReader(content));
			int event = parser.getEventType();
			while (event != XmlPullParser.END_DOCUMENT) {

				String nodeName = parser.getName();
				switch (event) {
				case XmlPullParser.START_DOCUMENT:

					break;
				case XmlPullParser.START_TAG:

					if (&quot;xml&quot;.equals(nodeName) == false) {
						// &#x5B9E;&#x4F8B;&#x5316;student&#x5BF9;&#x8C61;
						xml.put(nodeName, parser.nextText());
					}
					break;
				case XmlPullParser.END_TAG:
					break;
				}
				event = parser.next();
			}

			return xml;
		} catch (Exception e) {
			Log.e(&quot;orion&quot;, e.toString());
		}
		return null;

	}
    /**
     * &#x751F;&#x6210;&#x968F;&#x673A;&#x6570;
     * @return
     */
	private String genNonceStr() {
		Random random = new Random();
		return MD5.getMessageDigest(String.valueOf(random.nextInt(10000)).getBytes());
	}
    /**
     * &#x65F6;&#x95F4;&#x6233;
     * @return
     */
	private long genTimeStamp() {
		return System.currentTimeMillis() / 1000;
	}
    /**
     * &#x968F;&#x673A;&#x6570;
     * @return
     */
	private String genOutTradNo() {
		Random random = new Random();
		return MD5.getMessageDigest(String.valueOf(random.nextInt(10000)).getBytes());
	}
    /**
     * &#x83B7;&#x53D6;&#x8BBE;&#x5907;&#x7684;ip&#x5730;&#x5740;
     * @return
     */
	public String getLocalIpAddress() {
		try {
			for (Enumeration&lt;NetworkInterface&gt; en = NetworkInterface.getNetworkInterfaces(); en.hasMoreElements();) {
				NetworkInterface intf = en.nextElement();
				for (Enumeration&lt;InetAddress&gt; enumIpAddr = intf.getInetAddresses(); enumIpAddr.hasMoreElements();) {
					InetAddress inetAddress = enumIpAddr.nextElement();
					if (!inetAddress.isLoopbackAddress()) {
						return inetAddress.getHostAddress().toString();
					}
				}
			}
		} catch (SocketException ex) {
		}
		return null;
	}

	private String getWifiIp() {
		// &#x83B7;&#x53D6;wifi&#x670D;&#x52A1;
		WifiManager wifiManager = (WifiManager) getSystemService(Context.WIFI_SERVICE);
		// &#x5224;&#x65AD;wifi&#x662F;&#x5426;&#x5F00;&#x542F;
		if (!wifiManager.isWifiEnabled()) {
			wifiManager.setWifiEnabled(true);
		}
		WifiInfo wifiInfo = wifiManager.getConnectionInfo();
		int ipAddress = wifiInfo.getIpAddress();
		String ip = intToIp(ipAddress);
		return ip;
	}
    /**
     * &#x8F6C;&#x5316;&#x6210;Ip&#x5730;&#x5740;&#x7684;&#x683C;&#x5F0F;
     * @param i
     * @return
     */
	private String intToIp(int i) {

		return (i &amp; 0xFF) + &quot;.&quot; + ((i &gt;&gt; 8) &amp; 0xFF) + &quot;.&quot; + ((i &gt;&gt; 16) &amp; 0xFF) + &quot;.&quot; + (i &gt;&gt; 24 &amp; 0xFF);
	}

	private String genProductArgs() {
		StringBuffer xml = new StringBuffer();
		String ip = getWifiIp();
		if (ip == &quot;&quot; &amp;&amp; ip == &quot;&quot;) {
			ip = getLocalIpAddress();
		}
		try {
			String nonceStr = genNonceStr();
			xml.append(&quot;&lt;/xml&gt;&quot;);
			List&lt;NameValuePair&gt; packageParams = new LinkedList&lt;NameValuePair&gt;();
			packageParams.add(new BasicNameValuePair(&quot;appid&quot;, Constants.APP_ID));
			packageParams.add(new BasicNameValuePair(&quot;body&quot;, &quot;APPtest&quot;));
			packageParams.add(new BasicNameValuePair(&quot;mch_id&quot;, Constants.MCH_ID));
			packageParams.add(new BasicNameValuePair(&quot;nonce_str&quot;, nonceStr));
			packageParams.add(new BasicNameValuePair(&quot;notify_url&quot;, ConfigUtil.NOTIFY_URL));
			packageParams.add(new BasicNameValuePair(&quot;out_trade_no&quot;, genOutTradNo()));
			packageParams.add(new BasicNameValuePair(&quot;spbill_create_ip&quot;, ip));
			packageParams.add(new BasicNameValuePair(&quot;total_fee&quot;, &quot;100&quot;));
			packageParams.add(new BasicNameValuePair(&quot;trade_type&quot;, &quot;APP&quot;));
			String sign = genPackageSign(packageParams);
			packageParams.add(new BasicNameValuePair(&quot;sign&quot;, sign));
			String xmlstring = toXml(packageParams);
			return xmlstring;
		} catch (Exception e) {
			Log.e(&quot;TAG&quot;, &quot;fail, ex = &quot; + e.getMessage());
			return null;
		}
	}

	private void genPayReq() {
		req.appId = Constants.APP_ID;
		req.partnerId = Constants.MCH_ID;
		req.prepayId = resultunifiedorder.get(&quot;prepay_id&quot;);
		req.packageValue = &quot;prepay_id=&quot; + resultunifiedorder.get(&quot;prepay_id&quot;);
		req.nonceStr = genNonceStr();
		req.timeStamp = String.valueOf(genTimeStamp());
		List&lt;NameValuePair&gt; signParams = new LinkedList&lt;NameValuePair&gt;();
		signParams.add(new BasicNameValuePair(&quot;appid&quot;, req.appId));
		signParams.add(new BasicNameValuePair(&quot;noncestr&quot;, req.nonceStr));
		signParams.add(new BasicNameValuePair(&quot;package&quot;, req.packageValue));
		signParams.add(new BasicNameValuePair(&quot;partnerid&quot;, req.partnerId));
		signParams.add(new BasicNameValuePair(&quot;prepayid&quot;, req.prepayId));
		signParams.add(new BasicNameValuePair(&quot;timestamp&quot;, req.timeStamp));
		req.sign = genAppSign(signParams);
		sb.append(&quot;sign\n&quot; + req.sign + &quot;\n\n&quot;);
		Log.e(&quot;orion==genPayReq===============&quot;, signParams.toString());

	}

	private void sendPayReq() {
		boolean sendReq = msgApi.sendReq(req);
		T.show(this, &quot;&#x5FAE;&#x4FE1;&#x8DF3;&#x8F6C;=====&quot;+sendReq+&quot;&quot;);
	}

}
</span></pre>
</div>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px">&#x91CC;&#x9762;&#x6CA1;&#x6709;&#x7684;&#x7C7B;&#xFF0C;&#xFF0C;&#xFF0C;&#xFF0C;&#x5450;&#xFF1A;&#xA0;<a href="http://download.csdn.net/detail/meijuanyou/9571223" target="_blank">http://download.csdn.net/detail/meijuanyou/9571223</a> &#xA0;&#x81EA;&#x5DF1;&#x4E0B;&#x8F7D;&#x4E00;&#x4E0B;&#x62F7;&#x8D1D;&#x4E00;&#x4E0B;&#x3002;&#x3002;&#x3002;</span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px">&#x53C2;&#x8003;&#x8D44;&#x6599; &#xA0; &#xA0;<a href="http://download.csdn.net/detail/meijuanyou/9571223" target="_blank">http://blog.csdn.net/meijuanyou/article/details/51863720</a></span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px">&#xA0;&#x5907;&#x5FD8;&#xFF0C;&#x5E0C;&#x671B;&#x80FD;&#x7ED9;&#x5927;&#x5BB6;&#x5E26;&#x6765;&#x5E2E;&#x52A9;&#x3002;&#x3002;&#x3002;</span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px">&#xA0;</span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px">&#xA0;</span></p>
<p><span style="font-family: &quot;comic sans ms&quot;, sans-serif; font-size: 16px">&#xA0;</span></p></div><div id="MySignature"></div>
<div class="clear"></div>
<div id="blog_post_info_block">
<div id="BlogPostCategory"></div>
<div id="EntryTag"></div>
<div id="blog_post_info">
</div>
<div class="clear"></div>
<div id="post_next_prev"></div>
</div>


		</div>
		<div class="postDesc">posted @ <span id="post-date">2016-11-18 16:32</span> <a href="http://www.cnblogs.com/yunfang/">&#x594B;&#x6597;&#x8005;&#x2014;cyf</a> &#x9605;&#x8BFB;(<span id="post_view_count">...</span>) &#x8BC4;&#x8BBA;(<span id="post_comment_count">...</span>)  <a href="https://i.cnblogs.com/EditPosts.aspx?postid=6078208" rel="nofollow">&#x7F16;&#x8F91;</a> <a href="#" onclick="AddToWz(6078208);return false;">&#x6536;&#x85CF;</a></div>
	</div>
	<script type="text/javascript">var allowComments=true,cb_blogId=252088,cb_entryId=6078208,cb_blogApp=currentBlogApp,cb_blogUserGuid='73367ff5-5b7d-e511-9fc1-ac853d9f53cc',cb_entryCreatedDate='2016/11/18 16:32:00';loadViewCount(cb_entryId);</script>
	
</div><!--end: topics 文章、评论容器-->
</div><a name="!comments"></a><div id="blog-comments-placeholder"></div><script type="text/javascript">var commentManager = new blogCommentManager();commentManager.renderComments(0);</script>
<div id="comment_form" class="commentform">
<a name="commentform"></a>
<div id="divCommentShow"></div>
<div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" onclick="return RefreshCommentList();" id="lnk_RefreshComments" runat="server" clientidmode="Static">&#x5237;&#x65B0;&#x8BC4;&#x8BBA;</a><a href="#" onclick="return RefreshPage();">&#x5237;&#x65B0;&#x9875;&#x9762;</a><a href="#top">&#x8FD4;&#x56DE;&#x9876;&#x90E8;</a></div>
<div id="comment_form_container"></div>
<div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
<div id="ad_t2"></div>
<div id="opt_under_post"></div>
<div id="ad_c1" class="c_ad_block"></div>
<div id="under_post_news"></div>
<div id="ad_c2" class="c_ad_block"></div>
<div id="under_post_kb"></div>
<div id="HistoryToday" class="c_ad_block"></div>
<script type="text/javascript">
    fixPostBody();
    setTimeout(function () { incrementViewCount(cb_entryId); }, 50);
    deliverAdT2();
    deliverAdC1();
    deliverAdC2();    
    loadNewsAndKb();
    loadBlogSignature();
    LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
    GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate);
    loadOptUnderPost();
    GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);   
</script>
</div>


	</div><!--end: forFlow -->
	</div><!--end: mainContent 主体内容容器-->

	<div id="sideBar">
		<div id="sideBarMain">
			
<!--done-->
<div class="newsItem">
<h3 class="catListTitle">&#x516C;&#x544A;</h3>
	<div id="blog-news"></div><script type="text/javascript">loadBlogNews();</script>
</div>

			<div id="blog-calendar" style="display:none"></div><script type="text/javascript">loadBlogDefaultCalendar();</script>
			
			<div id="leftcontentcontainer">
				<div id="blog-sidecolumn"></div><script type="text/javascript">loadBlogSideColumn();</script>
			</div>
			
		</div><!--end: sideBarMain -->
	</div><!--end: sideBar 侧边栏容器 -->
	<div class="clear"></div>
	